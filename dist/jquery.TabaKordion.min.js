/*
* jQuery TabaKordion - v2.2.0
* A fully accessible to WAI specification; tabs, accordion and show/hide jQuery plugin using ARIA attributes.
*
* Code: https://github.com/tariqkhan-co-uk/TabaKordion
* Please report issues at: https://github.com/tariqkhan-co-uk/TabaKordion/issues
*
* Copyright (c) 2014 Tariq Khan (http://www.tariqkhan.co.uk/)
*
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*/
(function(d,l,n){function h(b,a){this.element=b;this.options=d.extend({},k,a);this._defaults=k;this._name="TabaKordion";this.$TabaKordion=d(b);this.$TabaKordion.hasClass("tabs")?this.options.accordion=!1:this.$TabaKordion.hasClass("nomultiselect")?this.options.multiSelect=!1:this.$TabaKordion.hasClass("showhide")&&(this.options.showHide=!0);this.$tabs=this.options.showHide?this.$TabaKordion:this.$TabaKordion.find(".tab");this.$panels=this.options.showHide?d(this.$TabaKordion.attr("href")):this.$TabaKordion.children(".panel"); this.keys=new m;this.bindEventHandlers();this.init()}function m(){this.tab=9;this.enter=13;this.esc=27;this.space=32;this.pageup=33;this.pagedown=34;this.end=35;this.home=36;this.left=37;this.up=38;this.right=39;this.down=40}var k={accordion:!0,openFirst:!0,multiSelect:!0,showHide:!1};d.extend(d.expr[":"],{focusable:function(b){var a=b.nodeName.toLowerCase(),c=d(b).attr("tabindex");return 1==d(b)["area"==a?"parents":"closest"](":hidden").length||!isNaN(c)&&0>c?!1:1==/input|select|textarea|button|object/.test(a)? !b.disabled:1==("a"==a||"area"==a)?0<b.href.length:!1}});h.prototype={init:function(){this.options.showHide?(this.$tabs.attr("aria-expanded","false").attr("aria-controls",this.$panels.attr("id")).prepend("<span>Show</span> "),this.$panels.attr("aria-expanded","false").attr("aria-labelledby",this.$tabs.attr("id")).attr("role","region").attr("tabindex","-1").addClass("showhide-region").hide()):(this.$panels.attr("role","tabpanel").attr("aria-hidden","true").hide(),this.$tabs.attr("role","tab").attr("aria-selected", "false").attr("tabindex","-1"),this.options.accordion?(this.$TabaKordion.attr("role","tablist"),this.options.multiSelect&&this.$TabaKordion.attr("multiselectable",!0),this.$tabs.attr("aria-expanded","false").append(' <span class="visually-hidden">(collapsed)</span>')):(this.$TabaKordion.find("ul:first-child").attr("role","tablist"),this.$tabs.find("a").each(function(){d(this).replaceWith("<span>"+d(this).text()+"</span>")})));var b,a=!1,c=l.location.hash;c&&(c=c.substring(1),this.options.showHide&& (this.$tabs.attr("id")==c||this.$panels.attr("id")==c||this.$panels.find("#"+c).length)?this.toggleRegion():this.$TabaKordion.find(c).length&&(c=c.substring(1),this.$tabs.removeClass("selected"),this.$tabs.each(function(){if(d(this).attr("id")==c)return a=d(this),!1}),!1===a&&this.$panels.each(function(){if(d(this).attr("id")==c)return a=d("#"+d(this).attr("aria-labelledby")),!1}),!1===a&&(a=d("#"+d("#"+c).parents(".panel").attr("aria-labelledby"))),!1!==a&&a.addClass("selected")));this.options.showHide|| (b=this.$tabs.filter(".selected"),!b.length&&this.options.openFirst&&(b=this.$tabs.first()),b.addClass("selected").attr("aria-selected","true").attr("tabindex","0"),this.options.accordion&&b.attr("aria-expanded","true").find(".visually-hidden").text("(expanded)"),this.$TabaKordion.find("#"+b.attr("aria-controls")).show().attr("aria-hidden","false"))},bindEventHandlers:function(){var b=this;this.$tabs.keydown(function(a){return b.tabKeyDownHandler(d(this),a)});this.$tabs.click(function(a){return b.tabClickHandler(d(this), a)});this.$tabs.focus(function(a){return b.tabFocusHandler(d(this),a)});this.$tabs.blur(function(a){return b.tabBlurHandler(d(this),a)});this.options.showHide||this.$panels.keydown(function(a){return b.panelElementsKeyDownHandler(d(this),a)});this.options.accordion&&this.$panels.click(function(a){return b.panelElementsClickHandler(d(this),a)});this.options.showHide&&this.$panels.blur(function(a){return b.panelBlurHandler(d(this),a)})},toggleRegion:function(){var b=this.$tabs;this.$panels.slideToggle(function(){"false"=== d(this).attr("aria-expanded")?(d(this).attr("aria-expanded","true").focus(),b.attr("aria-expanded","true").addClass("selected").find("span").html("Hide")):(d(this).attr("aria-expanded","false"),b.attr("aria-expanded","false").removeClass("selected").find("span").html("Show"))})},togglePanel:function(b){this.options.accordion?this.options.accordion&&!this.options.multiSelect&&(this.$tabs.attr("aria-expanded","false").find(".visually-hidden").text("(collapsed)"),this.$panels.attr("aria-hidden","true").slideUp()): this.$panels.attr("aria-hidden","true").hide();var a=this.$TabaKordion.find("#"+b.attr("aria-controls"));"true"===a.attr("aria-hidden")?(a.attr("aria-hidden","false"),this.options.accordion?(b.attr("aria-expanded","true").find(".visually-hidden").text("(expanded)"),a.slideDown()):a.show()):(a.attr("aria-hidden","true"),this.options.accordion?(b.attr("aria-expanded","false").find(".visually-hidden").text("(collapsed)"),a.slideUp()):a.hide());d("html, body").stop().animate({scrollTop:b.offset().top})}, switchTabs:function(b,a){b.removeClass("selected focus").attr("tabindex","-1").attr("aria-selected","false");this.options.accordion||(this.$TabaKordion.find("#"+b.attr("aria-controls")).hide().attr("aria-hidden","true"),this.$TabaKordion.find("#"+a.attr("aria-controls")).show().attr("aria-hidden","false"));a.addClass("selected").attr("aria-selected","true").attr("tabindex","0").focus();d("html, body").stop().animate({scrollTop:a.offset().top})},tabKeyDownHandler:function(b,a){if(a.altKey||this.options.showHide&& a.keyCode!==this.keys.enter&&a.keyCode!==this.keys.space)return!0;switch(a.keyCode){case this.keys.enter:case this.keys.space:return this.options.accordion?(this.options.showHide?this.toggleRegion():this.togglePanel(b),a.stopPropagation(),!1):!0;case this.keys.left:case this.keys.up:if(!a.ctrlKey){var c=this.$tabs.index(b),c=0==c?this.$tabs.last():this.$tabs.eq(c-1);this.switchTabs(b,c)}a.stopPropagation();return!1;case this.keys.right:case this.keys.down:return c=this.$tabs.index(b),c=c==this.$tabs.length- 1?this.$tabs.first():this.$tabs.eq(c+1),this.switchTabs(b,c),a.stopPropagation(),!1;case this.keys.home:return this.switchTabs(b,this.$tabs.first()),a.stopPropagation(),!1;case this.keys.end:return this.switchTabs(b,this.$tabs.last()),a.stopPropagation(),!1}},tabClickHandler:function(b,a){this.options.showHide?this.toggleRegion():(b.addClass("selected").attr("tabindex","0").attr("aria-selected","true"),this.$tabs.not(b).attr("tabindex","-1").attr("aria-selected","false").removeClass("selected"),this.togglePanel(b)); return this.options.accordion?(a.stopPropagation(),!1):!0},tabFocusHandler:function(b,a){b.addClass("focus");return!0},tabBlurHandler:function(b,a){b.removeClass("focus");return!0},panelElementsKeyDownHandler:function(b,a){if(a.altKey)return!0;switch(a.keyCode){case this.keys.tab:var c=b.find(":focusable"),e=c.index(d(a.target)),f=this.$panels.index(b),g=this.$panels.length;if(a.shiftKey){if(0==e&&0<f)for(e=f-1;0<=e;e--)if(g=this.$panels.eq(e),f=d("#"+g.attr("aria-labelledby")),c.length=0,c=g.find(":focusable"), 0<c.length)return c.last().focus(),this.$tabs.attr("aria-selected","false").removeClass("selected"),f.attr("aria-selected","true").addClass("selected"),a.stopPropagation,!1}else if(f<g&&e==c.length-1)for(e=f+1;e<g;e++){var f=this.$panels.eq(e),h=d("#"+f.attr("aria-labelledby"));c.length=0;c=f.find(":focusable");if(0<c.length)return c.first().focus(),this.$tabs.attr("aria-selected","false").removeClass("selected"),h.attr("aria-selected","true").addClass("selected"),a.stopPropagation,!1}break;case this.keys.esc:case this.keys.left:case this.keys.up:if(a.keyCode!= this.keys.esc&&!a.ctrlKey)break;d("#"+b.attr("aria-labelledby")).focus();a.stopPropagation();return!1;case this.keys.pageup:case this.keys.pagedown:if(!a.ctrlKey)break;c=this.$tabs.filter(".selected");e=this.$tabs.index(c);g=a.keyCode==this.keys.pageup?0==e?this.$tabs.last():this.$tabs.eq(e-1):e==this.$tabs.length-1?this.$tabs.first():this.$tabs.eq(e+1);this.switchTabs(c,g);a.stopPropagation();a.preventDefault();return!1}return!0},panelBlurHandler:function(b,a){this.$tabs.removeClass("selected"); return!0},panelElementsClickHandler:function(b,a){if(this.options.showHide)this.$tabs.addClass("selected");else{var c=d("#"+b.attr("aria-labelledby")).attr("tabindex","0").attr("aria-selected","true").addClass("selected");this.$tabs.not(c).attr("tabindex","-1").attr("aria-selected","false").removeClass("selected")}return!0}};d.fn.TabaKordion=function(b){return this.each(function(){d.data(this,"plugin_TabaKordion")||d.data(this,"plugin_TabaKordion",new h(this,b))})}})(jQuery,window);
