/*
* jQuery TabaKordion - v1.0.0
* A fully accessible to WAI specification; tabs and accordion jQuery plugin.
* http://www.tariqkhan.co.uk/
*
* Made by Tariq Khan
* Under MIT License
*/
(function(d,l,n,p){function h(a,b){this.element=a;this.options=d.extend({},k,b);this._defaults=k;this._name="TabaKordion";this.$TabaKordion=d(a);this.$tabs=this.$TabaKordion.find(".tab");this.$panels=this.$TabaKordion.children(".panel");this.$TabaKordion.hasClass("tabs")&&(this.options.accordion=!1);this.keys=new m;this.bindEventHandlers();this.init()}function m(){this.tab=9;this.enter=13;this.esc=27;this.space=32;this.pageup=33;this.pagedown=34;this.end=35;this.home=36;this.left=37;this.up=38;this.right= 39;this.down=40}var k={accordion:!0,openFirst:!0};d.extend(d.expr[":"],{focusable:function(a){var b=a.nodeName.toLowerCase(),c=d(a).attr("tabindex");return 1==d(a)["area"==b?"parents":"closest"](":hidden").length||!isNaN(c)&&0>c?!1:1==/input|select|textarea|button|object/.test(b)?!a.disabled:1==("a"==b||"area"==b)?0<a.href.length:!1}});h.prototype={init:function(){this.$panels.attr("role","tabpanel").attr("aria-hidden","true").hide();this.$tabs.attr("role","tab").attr("aria-selected","false").attr("tabindex", "-1");this.options.accordion?this.$tabs.attr("aria-expanded","false").append(' <span class="visually-hidden">(collapsed)</span>'):this.$tabs.find("a").each(function(){d(this).replaceWith("<span>"+d(this).text()+"</span>")});var a=l.location.hash;a&&d(a).length&&(this.$tabs.removeClass("selected"),d(a).addClass("selected"));a=this.$tabs.filter(".selected");!a.length&&this.options.openFirst&&(a=this.$tabs.first());a.addClass("selected").attr("aria-selected","true").attr("tabindex","0");this.options.accordion&& a.attr("aria-expanded","true").find(".visually-hidden").text("(expanded)");this.$TabaKordion.find("#"+a.attr("aria-controls")).show().attr("aria-hidden","false")},bindEventHandlers:function(){var a=this;this.$tabs.keydown(function(b){return a.tabKeyDownHandler(d(this),b)});this.$tabs.click(function(b){return a.tabClickHandler(d(this),b)});this.$tabs.focus(function(b){return a.tabFocusHandler(d(this),b)});this.$tabs.blur(function(b){return a.tabBlurHandler(d(this),b)});this.$panels.keydown(function(b){return a.panelElementsKeyDownHandler(d(this), b)});this.options.accordion&&this.$panels.click(function(b){return a.panelElementsClickHandler(d(this),b)})},togglePanel:function(a){this.options.accordion||this.$panels.attr("aria-hidden","true").hide();$panel=this.$TabaKordion.find("#"+a.attr("aria-controls"));"true"==$panel.attr("aria-hidden")?($panel.attr("aria-hidden","false"),this.options.accordion?(a.attr("aria-expanded","true").find(".visually-hidden").text("(expanded)"),$panel.slideDown()):$panel.show()):($panel.attr("aria-hidden","true"), this.options.accordion?(a.attr("aria-expanded","false").find(".visually-hidden").text("(collapsed)"),$panel.slideUp()):$panel.hide())},switchTabs:function(a,b){a.removeClass("selected focus").attr("tabindex","-1").attr("aria-selected","false");this.options.accordion||(this.$TabaKordion.find("#"+a.attr("aria-controls")).hide().attr("aria-hidden","true"),this.$TabaKordion.find("#"+b.attr("aria-controls")).show().attr("aria-hidden","false"));b.addClass("selected").attr("aria-selected","true").attr("tabindex", "0").focus()},tabKeyDownHandler:function(a,b){if(b.altKey)return!0;switch(b.keyCode){case this.keys.enter:case this.keys.space:return this.options.accordion?(this.togglePanel(a),b.stopPropagation(),!1):!0;case this.keys.left:case this.keys.up:if(!b.ctrlKey){var c=this.$tabs.index(a),c=0==c?this.$tabs.last():this.$tabs.eq(c-1);this.switchTabs(a,c)}b.stopPropagation();return!1;case this.keys.right:case this.keys.down:return c=this.$tabs.index(a),c=c==this.$tabs.length-1?this.$tabs.first():this.$tabs.eq(c+ 1),this.switchTabs(a,c),b.stopPropagation(),!1;case this.keys.home:return this.switchTabs(a,this.$tabs.first()),b.stopPropagation(),!1;case this.keys.end:return this.switchTabs(a,this.$tabs.last()),b.stopPropagation(),!1}},tabClickHandler:function(a,b){a.addClass("selected").attr("tabindex","0").attr("aria-selected","true");this.$tabs.not(a).attr("tabindex","-1").attr("aria-selected","false").removeClass("selected");this.togglePanel(a);return this.options.accordion?(b.stopPropagation(),!1):!0},tabFocusHandler:function(a, b){a.addClass("focus");return!0},tabBlurHandler:function(a,b){a.removeClass("focus");return!0},panelElementsKeyDownHandler:function(a,b){if(b.altKey)return!0;switch(b.keyCode){case this.keys.tab:var c=a.find(":focusable"),e=c.index(d(b.target)),f=this.$panels.index(a),g=this.$panels.length;if(b.shiftKey){if(0==e&&0<f)for(e=f-1;0<=e;e--)if(g=this.$panels.eq(e),f=d("#"+g.attr("aria-labelledby")),c.length=0,c=g.find(":focusable"),0<c.length)return c.last().focus(),this.$tabs.attr("aria-selected","false").removeClass("selected"), f.attr("aria-selected","true").addClass("selected"),b.stopPropagation,!1}else if(f<g&&e==c.length-1)for(e=f+1;e<g;e++){var f=this.$panels.eq(e),h=d("#"+f.attr("aria-labelledby"));c.length=0;c=f.find(":focusable");if(0<c.length)return c.first().focus(),this.$tabs.attr("aria-selected","false").removeClass("selected"),h.attr("aria-selected","true").addClass("selected"),b.stopPropagation,!1}break;case this.keys.esc:case this.keys.left:case this.keys.up:if(b.keyCode!=this.keys.esc&&!b.ctrlKey)break;d("#"+ a.attr("aria-labelledby")).focus();b.stopPropagation();return!1;case this.keys.pageup:case this.keys.pagedown:if(!b.ctrlKey)break;c=this.$tabs.filter(".selected");e=this.$tabs.index(c);g=b.keyCode==this.keys.pageup?0==e?this.$tabs.last():this.$tabs.eq(e-1):e==this.$tabs.length-1?this.$tabs.first():this.$tabs.eq(e+1);this.switchTabs(c,g);b.stopPropagation();b.preventDefault();return!1}return!0},panelElementsClickHandler:function(a,b){var c=d("#"+a.attr("aria-labelledby")).attr("tabindex","0").attr("aria-selected", "true").addClass("selected");this.$tabs.not(c).attr("tabindex","-1").attr("aria-selected","false").removeClass("selected");return!0}};d.fn.TabaKordion=function(a){return this.each(function(){d.data(this,"plugin_TabaKordion")||d.data(this,"plugin_TabaKordion",new h(this,a))})}})(jQuery,window,document);
